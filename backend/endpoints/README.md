# Food IQ: Image Recognition with LLM-Powered Recommendations

This module provides integration between the image recognition system (using TensorFlow) and the LLM-powered recommendation system. It allows users to upload food images, get them identified, and receive personalized nutritional recommendations based on their health profile.

## Features

- Food image recognition using a TensorFlow CNN model
- Personalized food recommendations generated by the Zephyr-7B-beta LLM
- Optional recommendation storage in the database
- Detailed nutritional analysis of recognized foods
- Macronutrient breakdown calculation

## Endpoints

### 1. `/image/predict`

**Basic food recognition endpoint**

This endpoint predicts what food is in an uploaded image and returns its nutritional information. If a user ID is provided, it also generates a personalized recommendation.

```
POST /image/predict
```

Parameters:
- `file`: The image file to upload (required)
- `user_id`: The ID of the user to generate recommendations for (optional)
- `context`: Additional context for the recommendation (optional)

### 2. `/image/predict-with-recommendation`

**Enhanced food recognition with recommendation storage**

This endpoint is similar to `/predict` but provides more control over the recommendation generation and includes an option to save the recommendation to the database.

```
POST /image/predict-with-recommendation
```

Parameters:
- `file`: The image file to upload (required)
- `user_id`: The ID of the user to generate recommendations for (optional)
- `context`: Additional context for the recommendation (optional)
- `save_recommendation`: Whether to save the recommendation to the database (optional, default: false)

### 3. `/image/analyze`

**Comprehensive food analysis endpoint**

This endpoint provides comprehensive analysis including macronutrient breakdowns and automatically saves the recommendation to the database.

```
POST /image/analyze
```

Parameters:
- `file`: The image file to upload (required)
- `user_id`: The ID of the user to generate recommendations for (optional)
- `context`: Additional context for the recommendation (optional)
- `save_recommendation`: Whether to save the recommendation to the database (optional, default: true)

### 4. `/image/food-classes`

**Get available food classes**

Retrieves a list of food classes that the model can recognize.

```
GET /image/food-classes
```

## Integration with User Profiles

For personalized recommendations, the system integrates user profile data with the food nutritional information:

1. The image is analyzed to identify the food
2. Nutritional information for the food is retrieved from the database
3. The user's profile is fetched (if a user ID is provided)
4. The LLM service is used to generate personalized recommendations based on:
   - User's health profile (allergies, health issues, weight goals, etc.)
   - The nutritional content of the identified food
   - Any additional provided context

## Example Usage

Here's an example API call using cURL:

```bash
curl -X POST "http://localhost:8000/image/analyze" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@food_image.jpg" \
  -F "user_id=1" \
  -F "context=Looking for a healthy meal option"
```

The response will include:
- The predicted food name
- Confidence level of the prediction
- Nutritional information
- Personalized recommendation
- Macronutrient breakdown 